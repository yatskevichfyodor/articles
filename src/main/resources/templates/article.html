<!DOCTYPE HTML>

<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <meta charset="utf-8"/>

    <title th:text="#{sitename}">My Site | Home</title>

    <link rel="shortcut icon" type="image/x-icon" th:href="@{/favicon.ico}"/>

    <link rel="stylesheet" type="text/css" href="/webjars/bootstrap/4.0.0-beta-1/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="/webjars/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/styles.css}"/>
</head>

<body th:class="${#themes.code('body.class')}">

<div th:replace="fragments/header :: header"></div>

<div th:class="'container mt-4 pt-3 pb-5 ' + ${#themes.code('body.class')}">

    <div class="row">
        <div class="text-left col">
            <h2 class="header" th:text="${article.getTitle()}"></h2>
            <div class="mt-2">
                <span class="font-italic" th:text="#{article.author}+':'"></span>
                <a class="font-italic" th:href="@{'/user/' + ${article.getAuthor().getUsername()}}"
                   th:text="${article.getAuthor().getUsername()}"></a>
                <br/>
                <span class="font-italic" th:text="#{article.date}+':'"></span>
                <b class="font-italic" th:text="${article.getTimestamp().toString()}"></b>
                <br/>
                <span class="font-italic" th:text="#{article.category}+':'"></span>
                <b class="font-italic" th:text="${article.getCategory().getName()}"></b>
            </div>
        </div>
        <div class="text-right col">
            <image th:src="${article.getImage().getData()}" width="100%" height="100%"></image>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <hr/>
        </div>
    </div>

    <div class="row mt-3">
        <div class="col-md-12">
            <p th:text="${article.getContent()}"></p>
        </div>
    </div>

    <div id="comment-block">
        <h5 class="contents pt-5 mb-4" th:text="#{article.comments}">Comments</h5>
        <div id="comments">
            <div class="row" th:each="comment : ${article.getComments()}">
                <div class="col-md-6 border border-left-0 border-right-0">
                    <div class="row mt-1">
                        <div class="col-md-4">
                            <span><b>by</b>
                                <a th:href="@{'/user/' + ${comment.getAuthor().getUsername()}}" class="font-weight-bold"
                                   th:text="${comment.getAuthor().getUsername()}"></a>
                            </span>
                        </div>
                        <span class="col-md-4" th:text="${comment.getTimestamp().toString()}"></span>
                        <div th:if="${currentUser.isAnonymous()}">
                            <div th:if="${comment.getAuthor().getId() == currentUser.getId() or currentUser.isAdmin() == true}"
                                 class="col-md-4 text-right">
                        <span onclick="delComment();" class="clickable-icon" id="btn-del" th:value="${comment.getId()}">
                            <i class="fa fa-trash-o  mr-2 mt-2"></i>
                        </span>
                            </div>
                        </div>
                    </div>
                    <p class="mt-1" th:text="${comment.getText()}"></p>
                </div>
            </div>
        </div>
        <div sec:authorize="isAuthenticated()">
            <div class="row">
                <div class="col-md-6">
                    <textarea class="form-control mt-3 textarea" rows="5" id="textarea-comment"
                              th:placeholder="#{article.comment.write}"></textarea>
                </div>
            </div>

            <div class="row mt-1">
                <div class="col-md-1">
                    <button type="button" class="btn btn-secondary btn-sm" id="btn-comment-add"
                            th:text="#{article.comment.add}">Add comment
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/webjars/jquery/3.2.0/jquery.min.js" type="text/javascript"></script>
<script th:src="@{/js/popper.min.js}" type="text/javascript"></script>
<script src="/webjars/bootstrap/4.0.0-beta-1/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/webjars/sockjs-client/1.0.2/sockjs.min.js"></script>
<script src="/webjars/stomp-websocket/2.3.3/stomp.min.js"></script>
<script th:src="@{/js/article.js}" type="text/javascript"></script>


</body>
</html>